# 要件定義書
YouTube分析バッチシステム

## 1. 目的
YouTube Data API を利用して動画およびコメント情報を取得し、
感情分析（3モデルアンサンブル + ルールベース）を行い、集計結果を MySQL に保存する。

本システムは分析用バッチ処理を目的とし、
再実行性・法人利用・拡張性を前提とする。

## 2. 対象範囲
- 動画メトリクス取得
- コメント取得
- 感情分析（多言語対応）
- 集計・MySQL保存
- MySQL管理画面提供

## 3. 機能要件
### 3.1 動画メトリクス取得
YouTube Data API v3 を使用し、動画IDごとに各種メトリクスを取得する。

### 3.2 コメント取得
- デフォルト：10件
- バッチパラメータ指定時：指定件数
- いいね数順で取得

### 3.3 中間データ保存
JSON形式で保存し、再集計可能とする。

### 3.4 感情分析
Transformersモデル（3モデルアンサンブル）+ 200以上のルールパターンにより感情分析を行い、positive/negative/neutral の確率スコアを算出する。

### 3.5 集計・保存
動画単位で集計し MySQL に保存する。

## 4. 非機能要件
- Docker実行
- データ永続化
- 認証情報は.env管理

### 4.1 実行頻度・スケジュール
- 手動実行（スケジューラ不使用）
- Dockerコマンドによるバッチ実行

```bash
# 単一動画
docker compose exec app python main.py --video-id VIDEO_ID

# コメント取得件数を指定
docker compose exec app python main.py --video-id VIDEO_ID --comment-limit 50

# 複数動画
docker compose exec app python main.py --video-ids VIDEO_ID1,VIDEO_ID2,VIDEO_ID3
```

## 5. APIクォータ対策

### 5.1 YouTube Data API v3 のクォータ制限
- 1日あたり10,000ユニット（デフォルト）
- 主なコスト:
  - videos.list: 1ユニット
  - commentThreads.list: 1ユニット

### 5.2 対策方針
1. **リクエスト最適化**
   - 必要なフィールドのみ取得（part パラメータの最適化）
   - バッチリクエストで複数動画を一括取得（最大50件）

2. **キャッシュ活用**
   - 取得済みデータはJSON中間ファイルに保存
   - 再分析時はAPIを呼ばず既存JSONを利用

3. **エラーハンドリング**
   - クォータ超過時（403エラー）は処理を中断しログ出力
   - リトライは翌日まで待機

4. **実行管理**
   - 1回のバッチで処理する動画数を制限可能
   - クォータ使用量をログに記録
