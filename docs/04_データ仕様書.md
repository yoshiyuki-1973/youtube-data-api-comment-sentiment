# データ仕様書
YouTube分析バッチシステム

## 1. JSON仕様

### 1.1 ファイル形式
- 形式: 1動画1JSONファイル
- 保存先: `./data/json/`
- ファイル名: `{video_id}.json`

### 1.2 JSONスキーマ
```json
{
  "video_id": "string",
  "title": "string",
  "channel_id": "string",
  "channel_title": "string",
  "published_at": "string (ISO 8601)",
  "view_count": "integer",
  "like_count": "integer",
  "comment_count": "integer",
  "fetched_at": "string (ISO 8601)",
  "comments": [
    {
      "comment_id": "string",
      "author": "string",
      "text": "string",
      "like_count": "integer",
      "published_at": "string (ISO 8601)",
      "sentiment": {
        "positive": "float (0.0-1.0)",
        "negative": "float (0.0-1.0)",
        "neutral": "float (0.0-1.0)",
        "language": "string (ja/other)"
      }
    }
  ]
}
```

## 2. MySQL仕様

- データベース名: `youtube_analytics`

### 2.1 videosテーブル
動画メタ情報を格納する。

| カラム名 | データ型 | 制約 | 説明 |
|---------|---------|------|------|
| id | BIGINT | PK, AUTO_INCREMENT | 内部ID |
| video_id | VARCHAR(20) | UNIQUE, NOT NULL | YouTube動画ID |
| title | VARCHAR(255) | NOT NULL | 動画タイトル |
| channel_id | VARCHAR(30) | NOT NULL | チャンネルID |
| channel_title | VARCHAR(255) | | チャンネル名 |
| published_at | DATETIME | | 公開日時 |
| view_count | BIGINT | DEFAULT 0 | 再生回数 |
| like_count | BIGINT | DEFAULT 0 | いいね数 |
| comment_count | BIGINT | DEFAULT 0 | コメント数 |
| fetched_at | DATETIME | NOT NULL | 取得日時 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 登録日時 |
| updated_at | DATETIME | ON UPDATE CURRENT_TIMESTAMP | 更新日時 |

### 2.2 video_comment_summaryテーブル
動画ごとの感情分析集計結果を格納する。

| カラム名 | データ型 | 制約 | 説明 |
|---------|---------|------|------|
| id | BIGINT | PK, AUTO_INCREMENT | 内部ID |
| video_id | VARCHAR(20) | FK, NOT NULL | YouTube動画ID |
| total_comments | INT | DEFAULT 0 | 分析対象コメント数 |
| positive_score | DECIMAL(5,4) | | positive平均確率 (0.0-1.0) |
| negative_score | DECIMAL(5,4) | | negative平均確率 (0.0-1.0) |
| neutral_score | DECIMAL(5,4) | | neutral平均確率 (0.0-1.0) |
| analyzed_at | DATETIME | NOT NULL | 分析日時 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 登録日時 |

**注**: 3値スコア形式。`positive_score + negative_score + neutral_score ≈ 1.0`

### 2.3 インデックス
- `videos.video_id` - UNIQUE INDEX
- `video_comment_summary.video_id` - INDEX (FK)
